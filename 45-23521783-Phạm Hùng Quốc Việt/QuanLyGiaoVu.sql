--Quản lí giáo vụ

-- Tạo DATABASE QLGV
CREATE DATABASE QLGV
GO
USE QLGV
GO
--I. Ngôn ngữ định nghĩa dữ liệu (Data Definition Language):

--1. Tạo quan hệ và khai báo tất cả các ràng buộc khóa chính, khóa ngoại. Thêm vào 3 thuộc tính GHICHU, DIEMTB, XEPLOAI cho quan hệ HOCVIEN.
----------------------------------- KHOA ----------------------------------------------
CREATE TABLE KHOA
( 
MAKHOA varchar(4) not null,
TENKHOA varchar(40),
NGTLAP smalldatetime,
TRGKHOA char(4),
)
---------------------------------- MONHOC ---------------------------------------------
CREATE TABLE MONHOC
(
MAMH varchar(10) not null,
TENMH varchar(40),
TCLT tinyint,
TCTH tinyint,
MAKHOA varchar(4) not null,
)
--------------------------------- DIEUKIEN --------------------------------------------
CREATE TABLE DIEUKIEN
(
MAMH varchar(10) not null,
MAMH_TRUOC varchar(10)not null,
)
--------------------------------- GIAOVIEN --------------------------------------------
CREATE TABLE GIAOVIEN
(
MAGV char(4) not null,
HOTEN varchar(40),
HOCVI varchar(10),
HOCHAM varchar(10),
GIOITINH varchar(3),
NGSINH smalldatetime,
NGVL smalldatetime,
HESO numeric(4,2),
MUCLUONG money,
MAKHOA varchar(4) not null,
)
----------------------------------- LOP -----------------------------------------------
CREATE TABLE LOP
(
MALOP char(3) not null,
TENLOP varchar(40),
TRGLOP char(5),
SISO tinyint,
MAGVCN char(4) not null,
)
--------------------------------- HOCVIEN ---------------------------------------------
CREATE TABLE HOCVIEN
(
MAHV char(5) not null,
HO varchar(40),
TEN varchar(10),
NGSINH smalldatetime,
GIOITINH varchar(3),
NOISINH varchar(40),
MALOP char(3) not null,
)
--------------------------------- GIANGDAY --------------------------------------------
CREATE TABLE GIANGDAY
( 
MALOP char(3)not null,
MAMH varchar(10) not null,
MAGV char(4) not null,
HOCKY tinyint,
NAM smallint,
TUNGAY smalldatetime,
DENNGAY smalldatetime,
)
--------------------------------- KETQUATHI -------------------------------------------
CREATE TABLE KETQUATHI
(
MAHV char(5)not null,
MAMH varchar(10) not null,
LANTHI tinyint not null,
NGTHI smalldatetime,
DIEM numeric(4,2),
KQUA varchar(10),
)
GO
--------------------khai báo tất cả các ràng buộc khóa chính, khóa ngoại----------------

ALTER TABLE KHOA ADD CONSTRAINT pk_kh PRIMARY KEY (MAKHOA)

ALTER TABLE MONHOC ADD CONSTRAINT pk_mh PRIMARY KEY (MAMH)
ALTER TABLE MONHOC ADD FOREIGN KEY (MAKHOA) REFERENCES KHOA(MAKHOA)

ALTER TABLE DIEUKIEN ADD FOREIGN KEY (MAMH) REFERENCES MONHOC(MAMH)
ALTER TABLE DIEUKIEN ADD CONSTRAINT pk_dk PRIMARY KEY (MAMH,MAMH_TRUOC)

ALTER TABLE GIAOVIEN ADD CONSTRAINT pk_gv PRIMARY KEY (MAGV)
ALTER TABLE GIAOVIEN ADD FOREIGN KEY (MAKHOA) REFERENCES KHOA(MAKHOA)

ALTER TABLE LOP ADD CONSTRAINT pk_lop PRIMARY KEY (MALOP)
ALTER TABLE LOP ADD FOREIGN KEY (MAGVCN) REFERENCES GIAOVIEN(MAGV)

ALTER TABLE HOCVIEN ADD CONSTRAINT pk_hv PRIMARY KEY (MAHV)
ALTER TABLE HOCVIEN ADD FOREIGN KEY (MALOP) REFERENCES LOP(MALOP)

ALTER TABLE GIANGDAY ADD FOREIGN KEY (MALOP) REFERENCES LOP(MALOP)
ALTER TABLE GIANGDAY ADD FOREIGN KEY (MAMH) REFERENCES MONHOC(MAMH)
ALTER TABLE GIANGDAY ADD FOREIGN KEY (MAGV) REFERENCES GIAOVIEN(MAGV)
ALTER TABLE GIANGDAY ADD CONSTRAINT pk_gd PRIMARY KEY (MALOP, MAMH)

ALTER TABLE KETQUATHI ADD FOREIGN KEY (MAHV) REFERENCES HOCVIEN(MAHV)
ALTER TABLE KETQUATHI ADD FOREIGN KEY (MAMH) REFERENCES MONHOC(MAMH)
ALTER TABLE KETQUATHI ADD CONSTRAINT pk_kqt PRIMARY KEY (MAHV,MAMH,LANTHI)



-----Thêm vào 3 thuộc tính GHICHU, DIEMTB, XEPLOAI cho quan hệ HOCVIEN---------------------
ALTER TABLE HOCVIEN ADD GHICHU VARCHAR(60)
ALTER TABLE HOCVIEN ADD DIEMTB NUMERIC(4, 2)
ALTER TABLE HOCVIEN ADD XEPLOAI VARCHAR(10)
GO
--2. Mã học viên là một chuỗi 5 ký tự, 3 ký tự đầu là mã lớp, 2 ký tự cuối cùng là số thứ tự học viên trong lớp. VD: “K1101”.
CREATE FUNCTION check_valid_MALOP (@MAHV VARCHAR(5))
RETURNs TINYINT
AS 
BEGIN
	IF LEFT(@MAHV, 3) IN (SELECT MALOP FROM LOP)
		RETURN 1
    RETURN 0
END
GO

CREATE FUNCTION check_valid_STT (@MAHV VARCHAR(5), @MALOP_HOCVIEN VARCHAR(3))
RETURNs TINYINT
AS
BEGIN
    IF RIGHT(@MAHV, 2) BETWEEN 1 AND (SELECT SISO FROM LOP WHERE MALOP = @MALOP_HOCVIEN)
		RETURN 1
	RETURN 0
END
GO

ALTER TABLE HOCVIEN ADD CONSTRAINT CK_MAHV CHECK(
	LEN(MAHV) = 5 AND 
	dbo.check_valid_MALOP(MAHV) = 1 AND 
	dbo.check_valid_STT(MAHV, MALOP) = 1
)
GO

--3. Thuộc tính GIOITINH chỉ có giá trị là “Nam” hoặc “Nu”.
ALTER TABLE HOCVIEN ADD CONSTRAINT ck_gioitinh CHECK(GIOITINH in ('Nam', 'Nu'))
--4. Điểm số của một lần thi có giá trị từ 0 đến 10 và cần lưu đến 2 số lẽ (VD: 6.22).
ALTER TABLE KETQUATHI ADD CONSTRAINT ck_diem CHECK(DIEM BETWEEN 0 AND 10 )
--5. Kết quả thi là “Dat” nếu điểm từ 5 đến 10 và “Khong dat” nếu điểm nhỏ hơn 5.
ALTER TABLE KETQUATHI ADD CONSTRAINT ck_ketqua CHECK(KQUA = IIF(DIEM BETWEEN 5 AND 10, 'Dat', 'Khong dat'))
--6. Học viên thi một môn tối đa 3 lần.
ALTER TABLE KETQUATHI ADD CONSTRAINT ck_solanthi CHECK(LANTHI <= 3)
--7. Học kỳ chỉ có giá trị từ 1 đến 3.
ALTER TABLE GIANGDAY ADD CONSTRAINT ck_hocky CHECK(HOCKY BETWEEN 1 AND 3)
--8. Học vị của giáo viên chỉ có thể là “CN”, “KS”, “Ths”, ”TS”, ”PTS”.
ALTER TABLE GIAOVIEN ADD CONSTRAINT ck_hocvi CHECK(HOCVI IN ('CN','KS', 'Ths', 'TS', 'PTS'))
--9. Lớp trưởng của một lớp phải là học viên của lớp đó.
GO
CREATE TRIGGER TRG_UPD_LOPTRUONG ON LOP
FOR INSERT, UPDATE
AS
BEGIN
	IF NOT EXISTS (SELECT * FROM INSERTED I, HOCVIEN HV
	WHERE I.TRGLOP = HV.MAHV AND I.MALOP = HV.MALOP)
	BEGIN
		PRINT 'Error: Lop truong cua mot lop phai la hoc vien cua lop do'
		ROLLBACK TRANSACTION
	END
END
GO
CREATE TRIGGER trg_del_HOCVIEN ON HOCVIEN
FOR DELETE
AS
BEGIN
	IF EXISTS (SELECT * FROM DELETED D, INSERTED I, LOP L 
	WHERE D.MAHV = L.TRGLOP AND D.MALOP = L.MALOP)
	BEGIN
		PRINT 'Error: Hoc vien hien tai dang la truong lop'
		ROLLBACK TRANSACTION
	END
END
GO
--10. Trưởng khoa phải là giáo viên thuộc khoa và có học vị “TS” hoặc “PTS”.
CREATE TRIGGER TRG_INS_KHOA ON KHOA
FOR INSERT 
AS
BEGIN
	DECLARE @MaTruongKhoa CHAR(4), @MaKhoa CHAR(4), @HocVi CHAR(10), @MaGV CHAR(4)
	SELECT @MaTruongKhoa = TRGKHOA, @MaKhoa = MAKHOA
	FROM INSERTED
	SELECT @HocVi = HOCVI
	FROM GIAOVIEN
	WHERE MAGV = @MaTruongKhoa
	SELECT @MaGV = TRGKHOA
	FROM KHOA
	WHERE MAKHOA = @MaKhoa
	IF ((SELECT MAKHOA 
			FROM GIAOVIEN
			WHERE @MaTruongKhoa = @MaGV)<> @MaKhoa OR @MaTruongKhoa <> @MaGV OR @HocVi NOT IN ('TS','PTS'))
	BEGIN
		PRINT 'LOI: TRUONG KHOA KHONG HOP LE'
		ROLLBACK TRANSACTION
	END
	ELSE
	BEGIN
		PRINT 'THEM MOI MOT TRUONG KHOA THANH CONG'
	END
END 
GO
--11. Học viên ít nhất là 18 tuổi.
ALTER TABLE HOCVIEN ADD CONSTRAINT CK_TUOI CHECK(GETDATE() - NGSINH >= 18)
GO
--12. Giảng dạy một môn học ngày bắt đầu (TUNGAY) phải nhỏ hơn ngày kết thúc (DENNGAY).
ALTER TABLE GIANGDAY ADD CONSTRAINT CK_NGAY CHECK(TUNGAY < DENNGAY)
GO
--13. Giáo viên khi vào làm ít nhất là 22 tuổi.
ALTER TABLE GIAOVIEN ADD CONSTRAINT CK_NGVL CHECK(GETDATE() - NGVL >= 22)
GO
--14. Tất cả các môn học đều có số tín chỉ lý thuyết và tín chỉ thực hành chênh lệch nhau không quá 5.
ALTER TABLE MONHOC ADD CONSTRAINT CK_TC CHECK(ABS(TCLT - TCTH) <= 5)
GO
--15. Học viên chỉ được thi một môn học nào đó khi lớp của học viên đã học xong môn học này.
CREATE TRIGGER dcthi_insert_KETQUATHI
ON KETQUATHI
FOR INSERT
AS 
BEGIN
	DECLARE @NGAYTHI smalldatetime, @KETTHUC smalldatetime
	SELECT @NGAYTHI = NGTHI  FROM inserted
	SELECT @KETTHUC= DENNGAY FROM inserted JOIN HOCVIEN 
							 ON inserted.MAHV = HOCVIEN.MAHV JOIN GIANGDAY
							 ON inserted.MAMH=GIANGDAY.MAMH and HOCVIEN.MALOP = GIANGDAY.MALOP

	IF @NGAYTHI < @KETTHUC
	BEGIN 
	ROLLBACK TRANSACTION
	PRINT 'Học viên chỉ được thi một môn học nào đó khi lớp của học viên đã học xong môn học này.'
	END
END
GO
--16. Mỗi học kỳ của một năm học, một lớp chỉ được học tối đa 3 môn.
DROP TRIGGER montoida_GIANGDAY
CREATE TRIGGER montoida_GIANGDAY
ON GIANGDAY
FOR INSERT
AS
BEGIN 
	DECLARE @SOMONCUALOP INT 
	SELECT @SOMONCUALOP = COUNT(distinct GD.MAMH) FROM GIANGDAY GD JOIN inserted
													ON GD.MALOP = inserted.MALOP AND GD.HOCKY = inserted.HOCKY
IF @SOMONCUALOP > 3
	BEGIN 
	ROLLBACK TRANSACTION
	PRINT N'Mỗi học kỳ của một năm học, một lớp chỉ được học tối đa 3 môn.'
	END
END
GO
DROP TRIGGER  montoida_UPDATE_GIANGDAY
CREATE TRIGGER montoida_UPDATE_GIANGDAY
ON GIANGDAY
FOR UPDATE
AS
IF(UPDATE (HOCKY)OR UPDATE(NAM))
BEGIN 
	DECLARE @SOMONCUALOP INT 
	SELECT @SOMONCUALOP = COUNT(distinct GD.MAMH) FROM GIANGDAY GD JOIN inserted
													ON GD.MALOP = inserted.MALOP AND GD.HOCKY = inserted.HOCKY
IF @SOMONCUALOP > 3
	BEGIN 
	ROLLBACK TRANSACTION
	PRINT N'Mỗi học kỳ của một năm học, một lớp chỉ được học tối đa 3 môn.'
	END
END
GO
--17. Sỉ số của một lớp bằng với số lượng học viên thuộc lớp đó.
CREATE TRIGGER them_hocvien
ON HOCVIEN
FOR INSERT 
AS
BEGIN
	DECLARE @SISO INT , @MALOP char(3)
	SELECT @MALOP= inserted.MALOP FROM inserted
	SELECT @SISO = COUNT( DISTINCT MAHV) FROM HOCVIEN WHERE @MALOP = HOCVIEN.MALOP

	UPDATE LOP
	SET LOP.SISO = @SISO + 1
	WHERE @MALOP = LOP.MALOP
END
GO

CREATE TRIGGER xoa_hocvien
ON HOCVIEN
FOR DELETE 
AS
BEGIN
	DECLARE @SISO INT , @MALOP char(3)
	SELECT @MALOP= deleted.MALOP FROM deleted
	SELECT @SISO = COUNT( DISTINCT MAHV) FROM HOCVIEN WHERE @MALOP = HOCVIEN.MALOP

	UPDATE LOP
	SET LOP.SISO = @SISO - 1
	WHERE @MALOP = LOP.MALOP
END
GO

CREATE TRIGGER update_siso_LOP
ON LOP
FOR update
AS 
IF (UPDATE (SISO))
BEGIN
	DECLARE @SISOTHEM INT, @MALOP char(3),@SISO INT
	SELECT @SISOTHEM =SISO FROM inserted
	SELECT @MALOP = MALOP FROM inserted
	SELECT @SISO = COUNT(DISTINCT MAHV) FROM HOCVIEN WHERE @MALOP=HOCVIEN.MALOP

	IF  @SISO != @SISOTHEM
	BEGIN 
	ROLLBACK TRANSACTION
	PRINT N'Sỉ số của một lớp bằng với số lượng học viên thuộc lớp đó.'
	END
END
GO

--18. Trong quan hệ DIEUKIEN giá trị của thuộc tính MAMH và MAMH_TRUOC trong cùng
--một bộ không được giống nhau (“A”,”A”) và cũng không tồn tại hai bộ (“A”,”B”) và
--(“B”,”A”).
--
CREATE TRIGGER TRG_INS_DIEUKIEN ON DIEUKIEN
FOR INSERT
AS
BEGIN
    IF EXISTS (
        SELECT * 
        FROM INSERTED I
        WHERE I.MAMH = I.MAMH_TRUOC
           OR EXISTS (
                SELECT * 
                FROM DIEUKIEN D
                WHERE D.MAMH = I.MAMH_TRUOC 
                  AND D.MAMH_TRUOC = I.MAMH
           )
	)
	BEGIN
        PRINT 'LOI: DIEU KIEN KHONG HOP LE (GIA TRI TRUNG HOAC DOI XUNG)'
        ROLLBACK TRANSACTION
    END
    ELSE
    BEGIN
        PRINT 'THEM MOI DIEU KIEN THANH CONG'
    END
END
GO
--19. Các giáo viên có cùng học vị, học hàm, hệ số lương thì mức lương bằng nhau.
CREATE TRIGGER insert_giaovien
ON GIAOVIEN
FOR INSERT
AS 
BEGIN
	DECLARE @HOCVI varchar(10), @HOCHAM varchar(10), @HESO numeric(4,2),@MUCLUONG money, @MUCLUONGKHAC money
	SELECT @HOCVI = HOCVI FROM inserted
	SELECT @HOCHAM = HOCHAM FROM inserted
	SELECT @HESO = HESO , @MUCLUONG=MUCLUONG FROM inserted

	SELECT  @MUCLUONGKHAC = (SELECT TOP 1 MUCLUONG FROM GIAOVIEN GV WHERE GV.HOCVI = @HOCVI AND GV.HOCHAM =@HOCHAM AND GV.HESO= @HESO)
	
	IF @MUCLUONG != @MUCLUONGKHAC
	BEGIN 
	ROLLBACK TRANSACTION
	PRINT N'Các giáo viên có cùng học vị, học hàm, hệ số lương thì mức lương bằng nhau.'
	END
END
GO
CREATE TRIGGER UPDATE_giaovien
ON GIAOVIEN
FOR UPDATE 
AS
IF ( UPDATE(HOCVI) OR UPDATE(HOCHAM) OR UPDATE (HESO) OR UPDATE (MUCLUONG))
BEGIN 
DECLARE @HOCVI varchar(10), @HOCHAM varchar(10), @HESO numeric(4,2),@MUCLUONG money, @MUCLUONGKHAC money
	SELECT @HOCVI = HOCVI FROM inserted
	SELECT @HOCHAM = HOCHAM FROM inserted
	SELECT @HESO = HESO , @MUCLUONG=MUCLUONG FROM inserted

	SELECT  @MUCLUONGKHAC = (SELECT TOP 1 MUCLUONG FROM GIAOVIEN GV WHERE GV.HOCVI = @HOCVI AND GV.HOCHAM =@HOCHAM AND GV.HESO= @HESO)
	
	IF @MUCLUONG != @MUCLUONGKHAC
	BEGIN 
	ROLLBACK TRANSACTION
	PRINT N'Các giáo viên có cùng học vị, học hàm, hệ số lương thì mức lương bằng nhau.'
	END
END
GO

--20. Học viên chỉ được thi lại (lần thi >1) khi điểm của lần thi trước đó dưới 5.

--
CREATE TRIGGER TRG_INS_THILAI ON KETQUATHI
FOR INSERT
AS
BEGIN
    IF EXISTS (
        SELECT I.MAHV, I.MAMH
        FROM INSERTED I
        JOIN KETQUATHI KQ ON I.MAHV = KQ.MAHV AND I.MAMH = KQ.MAMH
        WHERE I.LANTHI > 1
          AND KQ.LANTHI = I.LANTHI - 1
          AND KQ.DIEM >= 5
    )
    BEGIN
        PRINT 'LOI: CHI DUOC THI LAI KHI DIEM LAN TRUOC DUOI 5'
        ROLLBACK TRANSACTION
    END
    ELSE
    BEGIN
        PRINT 'THEM KET QUA THI THANH CONG'
    END
END
GO
--21. Ngày thi của lần thi sau phải lớn hơn ngày thi của lần thi trước (cùng học viên, cùng môn học).
--
CREATE TRIGGER TRG_INS_KQT_NT ON KETQUATHI
FOR INSERT 
AS
BEGIN
	DECLARE @MaHV CHAR(5), @MaMH CHAR(10), @NgayThiTruoc SMALLDATETIME, @NgayThiSau SMALLDATETIME
	SELECT @MaHV = MAHV, @MaMH = MAMH
	FROM INSERTED

	SELECT  @NgayThiTruoc =  NGTHI
	FROM  ( SELECT TOP 1 * FROM  KETQUATHI KQT1
					WHERE KQT1.MAHV=@MaHV AND KQT1.MAMH =@MaMH
					ORDER BY LANTHI DESC) KQ

	SELECT @NgayThiSau = NGTHI FROM inserted

	IF(@NgayThiSau < @NgayThiTruoc)
	BEGIN
		PRINT'LOI: NGAY THI SAU KHONG HOP LE'
		ROLLBACK TRANSACTION
	END
	ELSE
	BEGIN
		PRINT'THEM MOT KET QUA THI THANH CONG'
	END
END
GO
--22. Học viên chỉ được thi những môn mà lớp của học viên đó đã học xong.
-- khá giống câu 15
CREATE TRIGGER dcthi_insert_KETQUATHI2
ON KETQUATHI
FOR INSERT
AS 
BEGIN
	DECLARE @NGAYTHI smalldatetime, @KETTHUC smalldatetime
	SELECT @NGAYTHI = NGTHI  FROM inserted
	SELECT @KETTHUC= DENNGAY FROM inserted JOIN HOCVIEN 
							 ON inserted.MAHV = HOCVIEN.MAHV JOIN GIANGDAY
							 ON inserted.MAMH=GIANGDAY.MAMH and HOCVIEN.MALOP = GIANGDAY.MALOP

	IF @NGAYTHI < @KETTHUC
	BEGIN 
	ROLLBACK TRANSACTION
	PRINT 'Học viên chỉ được thi những môn mà lớp của học viên đó đã học xong môn học này.'
	END
END
GO
--23. Khi phân công giảng dạy một môn học, phải xét đến thứ tự trước sau giữa các môn học (sau
--khi học xong những môn học phải học trước mới được học những môn liền sau).
CREATE TRIGGER TRG_INS_GD_MON ON GIANGDAY
FOR INSERT
AS
BEGIN
    IF EXISTS (
        SELECT I.MALOP, I.MAMH
        FROM INSERTED I
        JOIN DIEUKIEN DK ON I.MAMH = DK.MAMH
        JOIN GIANGDAY GD ON I.MALOP = GD.MALOP AND DK.MAMH_TRUOC = GD.MAMH
        WHERE GD.DENNGAY IS NULL OR GD.DENNGAY > I.TUNGAY
    )
    BEGIN
        PRINT 'LOI: KHONG THE GIANG DAY MON KHI CHUA HOAN TAT MON HOC TRUOC'
        ROLLBACK TRANSACTION
    END
    ELSE
    BEGIN
        PRINT 'PHAN CONG GIANG DAY THANH CONG'
    END
END
GO
--24. Giáo viên chỉ được phân công dạy những môn thuộc khoa giáo viên đó phụ trách.
CREATE TRIGGER TRG_INS_GD_GV ON GIANGDAY
FOR INSERT
AS
BEGIN
	DECLARE @MaGV CHAR(4), @MaKhoaMH CHAR(4),@MaKhoaGV CHAR(4), @MaMH CHAR(10)
	SELECT @MaGV = MAGV, @MaMH = MAMH
	FROM INSERTED

	SELECT @MaKhoaGV = MAKHOA
	FROM GIAOVIEN
	WHERE @MaGV = MAGV

	SELECT @MaKhoaMH = MAKHOA
	FROM MONHOC
	WHERE @MaMH = MAMH

	IF(@MaKhoaGV <> @MaKhoaMH)
	BEGIN
		PRINT'LOI: GIAO VIEN DAY MON KHONG HOP LE'
		ROLLBACK TRANSACTION
	END
	ELSE
	PRINT'THEM MOT GIAO VIEN GIANG DAY THANH CONG'
END
GO
-------------------------------Nhập dữ liệu cho KHOA -----------------------------------------------------
 INSERT INTO KHOA VALUES ( 'KHMT','Khoa hoc may tinh','2005-06-07','GV01')
 INSERT INTO KHOA VALUES ( 'HTTT','He thong thong tin','2005-06-07','GV02')
 INSERT INTO KHOA VALUES ( 'CNPM','Cong nghe phan mem','2005-06-07','GV04')
 INSERT INTO KHOA VALUES ( 'MTT','Mang va truyen thong','2005-10-20','GV03')
 INSERT INTO KHOA VALUES ( 'KTMT','Ky thuat may tinh','2005-12-20','Null')
 SELECT * FROM KHOA

-------------------------------Nhập dữ liệu cho GIAOVIEN -------------------------------------------------
INSERT INTO GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA)
VALUES ('GV01', 'Ho Thanh Son', 'PTS', 'GS', 'Nam', '1950-02-05', '2004-11-01', 5, 2250000, 'KHMT');

INSERT INTO GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA)
VALUES ('GV02', 'Tran Tam Thanh', 'TS', 'PGS', 'Nam', '1965-12-17', '2004-04-20', 4.5, 2025000, 'HTTT');

INSERT INTO GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA)
VALUES ('GV03', 'Do Nghiem Phung', 'TS', 'GS', 'Nu', '1950-01-08', '2004-09-23', 4, 1800000, 'CNPM');

INSERT INTO GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA)
VALUES ('GV04', 'Tran Nam Son', 'TS', 'PGS', 'Nam', '1961-02-22', '2005-12-01', 4.5, 2025000, 'KTMT');

INSERT INTO GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA)
VALUES ('GV05', 'Mai Thanh Danh', 'ThS', 'GV', 'Nam', '1958-12-03', '2005-12-01', 3, 1350000, 'HTTT');

INSERT INTO GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA)
VALUES ('GV06', 'Tran Doan Hung', 'TS', 'GV', 'Nam', '1953-11-03', '2005-12-01', 4.5, 2025000, 'KHMT');

INSERT INTO GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA)
VALUES ('GV07', 'Nguyen Minh Tien', 'ThS', 'GV', 'Nam', '1971-11-23', '2005-01-03', 4, 1800000, 'KHMT');

INSERT INTO GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA)
VALUES ('GV08', 'Le Thi Tran', 'KS', NULL, 'Nu', '1974-03-26', '2005-01-03', 1.69, 760500, 'KHMT');

INSERT INTO GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA)
VALUES ('GV09', 'Nguyen To Lan', 'ThS', 'GV', 'Nu', '1966-12-31', '2005-01-03', 4, 1800000, 'HTTT');

INSERT INTO GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA)
VALUES ('GV10', 'Le Tran Anh Loan', 'KS', NULL, 'Nu', '1972-07-17', '2005-01-03', 1.86, 837000, 'CNPM');

INSERT INTO GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA)
VALUES ('GV11', 'Ho Thanh Tung', 'CN', 'GV', 'Nam', '1980-12-01', '2005-05-15', 2.67, 1201500, 'MTT');

INSERT INTO GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA)
VALUES ('GV12', 'Tran Van Anh', 'CN', NULL, 'Nu', '1981-03-29', '2005-05-15', 1.69, 760500, 'CNPM');

INSERT INTO GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA)
VALUES ('GV13', 'Nguyen Linh Dan', 'CN', NULL, 'Nu', '1980-05-23', '2005-05-15', 1.69, 760500, 'KTMT');

INSERT INTO GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA)
VALUES ('GV14', 'Truong Minh Chau', 'ThS', 'GV', 'Nu', '1976-11-30', '2005-05-15', 3, 1350000, 'MTT');

INSERT INTO GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA)
VALUES ('GV15', 'Le Ha Thanh', 'ThS', 'GV', 'Nam', '1978-04-05', '2005-05-15', 3, 1350000, 'KHMT');
 SELECT * FROM GIAOVIEN
-------------------------------Nhập dữ liệu cho LOP ------------------------------------------------------
 INSERT INTO LOP VALUES ( 'K11','Lop 1 khoa 1','K1108','11','GV07')
 INSERT INTO LOP VALUES ( 'K12','Lop 2 khoa 1','K1205','12','GV09')
 INSERT INTO LOP VALUES ( 'K13','Lop 3 khoa 1','K1305','12','GV14')
 SELECT * FROM LOP
-------------------------------Nhập dữ liệu cho MONHOC ---------------------------------------------------
INSERT INTO MONHOC (MAMH, TENMH, TCLT, TCTH, MAKHOA)
VALUES ('THDC', 'Tin hoc dai cuong', 4, 1, 'KHMT');

INSERT INTO MONHOC (MAMH, TENMH, TCLT, TCTH, MAKHOA)
VALUES ('CTRR', 'Cau truc roi rac', 5, 0, 'KHMT');

INSERT INTO MONHOC (MAMH, TENMH, TCLT, TCTH, MAKHOA)
VALUES ('CSDL', 'Co so du lieu', 3, 1, 'HTTT');

INSERT INTO MONHOC (MAMH, TENMH, TCLT, TCTH, MAKHOA)
VALUES ('CTDLGT', 'Cau truc du lieu va giai thuat', 3, 1, 'KHMT');

INSERT INTO MONHOC (MAMH, TENMH, TCLT, TCTH, MAKHOA)
VALUES ('PTTKTT', 'Phan tich thiet ke thuat toan', 3, 0, 'KHMT');

INSERT INTO MONHOC (MAMH, TENMH, TCLT, TCTH, MAKHOA)
VALUES ('DHMT', 'Do hoa may tinh', 3, 1, 'KHMT');

INSERT INTO MONHOC (MAMH, TENMH, TCLT, TCTH, MAKHOA)
VALUES ('KTMT', 'Kien truc may tinh', 3, 0, 'KTMT');

INSERT INTO MONHOC (MAMH, TENMH, TCLT, TCTH, MAKHOA)
VALUES ('TKCSDL', 'Thiet ke co so du lieu', 3, 1, 'HTTT');

INSERT INTO MONHOC (MAMH, TENMH, TCLT, TCTH, MAKHOA)
VALUES ('PTTKHTTT', 'Phan tich thiet ke he thong thong tin', 4, 1, 'HTTT');

INSERT INTO MONHOC (MAMH, TENMH, TCLT, TCTH, MAKHOA)
VALUES ('HDH', 'He dieu hanh', 4, 0, 'KTMT');

INSERT INTO MONHOC (MAMH, TENMH, TCLT, TCTH, MAKHOA)
VALUES ('NMCNPM', 'Nhap mon cong nghe phan mem', 3, 0, 'CNPM');

INSERT INTO MONHOC (MAMH, TENMH, TCLT, TCTH, MAKHOA)
VALUES ('LTCFW', 'Lap trinh C for win', 3, 1, 'CNPM');

INSERT INTO MONHOC (MAMH, TENMH, TCLT, TCTH, MAKHOA)
VALUES ('LTHDT', 'Lap trinh huong doi tuong', 3, 1, 'CNPM');
SELECT * FROM MONHOC
-------------------------------Nhập dữ liệu cho GIANGDAY -------------------------------------------------
INSERT INTO GIANGDAY (MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY)
VALUES ('K11', 'THDC', 'GV07', 1, 2006, '2006-02-01', '2006-05-12');

INSERT INTO GIANGDAY (MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY)
VALUES ('K12', 'THDC', 'GV06', 1, 2006, '2006-02-01', '2006-05-12');

INSERT INTO GIANGDAY (MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY)
VALUES ('K13', 'THDC', 'GV15', 1, 2006, '2006-02-01', '2006-05-12');

INSERT INTO GIANGDAY (MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY)
VALUES ('K11', 'CTRR', 'GV02', 1, 2006, '2006-01-09', '2006-05-17');

INSERT INTO GIANGDAY (MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY)
VALUES ('K12', 'CTRR', 'GV02', 1, 2006, '2006-01-09', '2006-05-17');

INSERT INTO GIANGDAY (MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY)
VALUES ('K13', 'CTRR', 'GV08', 1, 2006, '2006-01-09', '2006-05-17');

INSERT INTO GIANGDAY (MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY)
VALUES ('K11', 'CSDL', 'GV05', 2, 2006, '2006-06-01', '2006-07-15');

INSERT INTO GIANGDAY (MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY)
VALUES ('K12', 'CSDL', 'GV09', 2, 2006, '2006-06-01', '2006-07-15');

INSERT INTO GIANGDAY (MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY)
VALUES ('K13', 'CTDLGT', 'GV15', 2, 2006, '2006-06-01', '2006-07-15');

INSERT INTO GIANGDAY (MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY)
VALUES ('K13', 'CSDL', 'GV05', 3, 2006, '2006-08-01', '2006-12-15');

INSERT INTO GIANGDAY (MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY)
VALUES ('K13', 'DHMT', 'GV07', 3, 2006, '2006-08-01', '2006-12-15');

INSERT INTO GIANGDAY (MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY)
VALUES ('K11', 'CTDLGT', 'GV15', 3, 2006, '2006-08-01', '2006-12-15');

INSERT INTO GIANGDAY (MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY)
VALUES ('K12', 'CTDLGT', 'GV15', 3, 2006, '2006-08-01', '2006-12-15');

INSERT INTO GIANGDAY (MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY)
VALUES ('K11', 'HDH', 'GV04', 1, 2007, '2007-01-02', '2007-02-18');

INSERT INTO GIANGDAY (MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY)
VALUES ('K12', 'HDH', 'GV04', 1, 2007, '2007-01-02', '2007-03-20');

INSERT INTO GIANGDAY (MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY)
VALUES ('K11', 'DHMT', 'GV07', 1, 2007, '2007-02-18', '2007-03-20');
SELECT * FROM GIANGDAY
-------------------------------Nhập dữ liệu cho DIEUKIEN -------------------------------------------------
INSERT INTO DIEUKIEN (MAMH, MAMH_TRUOC)
VALUES ('CSDL', 'CTRR');

INSERT INTO DIEUKIEN (MAMH, MAMH_TRUOC)
VALUES ('CSDL', 'CTDLGT');

INSERT INTO DIEUKIEN (MAMH, MAMH_TRUOC)
VALUES ('CTDLGT', 'THDC');

INSERT INTO DIEUKIEN (MAMH, MAMH_TRUOC)
VALUES ('PTTKTT', 'THDC');

INSERT INTO DIEUKIEN (MAMH, MAMH_TRUOC)
VALUES ('PTTKTT', 'CTDLGT');

INSERT INTO DIEUKIEN (MAMH, MAMH_TRUOC)
VALUES ('DHMT', 'THDC');

INSERT INTO DIEUKIEN (MAMH, MAMH_TRUOC)
VALUES ('LTHDT', 'THDC');

INSERT INTO DIEUKIEN (MAMH, MAMH_TRUOC)
VALUES ('PTTKHTTT', 'CSDL');
SELECT * FROM DIEUKIEN
-------------------------------Nhập dữ liệu cho HOCVIEN --------------------------------------------------
INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP, GHICHU, DIEMTB, XEPLOAI)
VALUES ('K1101', 'Nguyen Van', 'A', '1986-01-27', 'Nam', 'TpHCM', 'K11', NULL, NULL, NULL);

INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP, GHICHU, DIEMTB, XEPLOAI)
VALUES ('K1102', 'Tran Ngoc', 'Han', '1986-03-14', 'Nu', 'Kien Giang', 'K11', NULL, NULL, NULL);

INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP, GHICHU, DIEMTB, XEPLOAI)
VALUES ('K1103', 'Ha Duy', 'Lap', '1986-04-18', 'Nam', 'Nghe An', 'K11', NULL, NULL, NULL);

INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP, GHICHU, DIEMTB, XEPLOAI)
VALUES ('K1104', 'Tran Ngoc', 'Linh', '1986-03-30', 'Nu', 'Tay Ninh', 'K11', NULL, NULL, NULL);

INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP, GHICHU, DIEMTB, XEPLOAI)
VALUES ('K1105', 'Tran Minh', 'Long', '1986-02-27', 'Nam', 'TpHCM', 'K11', NULL, NULL, NULL);

INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP, GHICHU, DIEMTB, XEPLOAI)
VALUES ('K1106', 'Le Nhat', 'Minh', '1986-01-24', 'Nam', 'TpHCM', 'K11', NULL, NULL, NULL);

INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP, GHICHU, DIEMTB, XEPLOAI)
VALUES ('K1107', 'Nguyen Nhu', 'Nhut', '1986-01-27', 'Nam', 'Ha Noi', 'K11', NULL, NULL, NULL);

INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP, GHICHU, DIEMTB, XEPLOAI)
VALUES ('K1108', 'Nguyen Manh', 'Tam', '1986-02-27', 'Nam', 'Kien Giang', 'K11', NULL, NULL, NULL);

INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP, GHICHU, DIEMTB, XEPLOAI)
VALUES ('K1109', 'Phan Thi Thanh', 'Tam', '1986-01-27', 'Nu', 'Vinh Long', 'K11', NULL, NULL, NULL);

INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP, GHICHU, DIEMTB, XEPLOAI)
VALUES ('K1110', 'Le Hoai', 'Thuong', '1986-02-05', 'Nu', 'Can Tho', 'K11', NULL, NULL, NULL);

INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP, GHICHU, DIEMTB, XEPLOAI)
VALUES ('K1111', 'Le Ha', 'Vinh', '1986-12-25', 'Nam', 'Vinh Long', 'K11', NULL, NULL, NULL);

INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP, GHICHU, DIEMTB, XEPLOAI)
VALUES ('K1201', 'Nguyen Van', 'B', '1986-02-11', 'Nam', 'TpHCM', 'K12', NULL, NULL, NULL);

INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP, GHICHU, DIEMTB, XEPLOAI)
VALUES ('K1202', 'Nguyen Thi Kim', 'Duyen', '1986-01-18', 'Nu', 'TpHCM', 'K12', NULL, NULL, NULL);

INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP, GHICHU, DIEMTB, XEPLOAI)
VALUES ('K1203', 'Tran Thi Kim', 'Duyen', '1986-09-17', 'Nu', 'TpHCM', 'K12', NULL, NULL, NULL);

INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP, GHICHU, DIEMTB, XEPLOAI)
VALUES ('K1204', 'Truong My', 'Hanh', '1986-05-19', 'Nu', 'Dong Nai', 'K12', NULL, NULL, NULL);

INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP, GHICHU, DIEMTB, XEPLOAI)
VALUES ('K1205', 'Nguyen Thanh', 'Nam', '1986-04-17', 'Nam', 'TpHCM', 'K12', NULL, NULL, NULL);

INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP, GHICHU, DIEMTB, XEPLOAI)
VALUES ('K1206', 'Nguyen Thi Truc', 'Thanh', '1986-03-04', 'Nu', 'Kien Giang', 'K12', NULL, NULL, NULL);

INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP, GHICHU, DIEMTB, XEPLOAI)
VALUES ('K1207', 'Tran Thi Bich', 'Thuy', '1986-02-08', 'Nu', 'Nghe An', 'K12', NULL, NULL, NULL);

INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP, GHICHU, DIEMTB, XEPLOAI)
VALUES ('K1208', 'Huynh Thi Kim', 'Trieu', '1986-04-08', 'Nu', 'Tay Ninh', 'K12', NULL, NULL, NULL);

INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP, GHICHU, DIEMTB, XEPLOAI)
VALUES ('K1209', 'Pham Thanh', 'Trieu', '1986-02-23', 'Nam', 'TpHCM', 'K12', NULL, NULL, NULL);

INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP, GHICHU, DIEMTB, XEPLOAI)
VALUES ('K1210', 'Ngo Thanh', 'Tuan', '1986-02-14', 'Nam', 'TpHCM', 'K12', NULL, NULL, NULL);

INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP, GHICHU, DIEMTB, XEPLOAI)
VALUES ('K1211', 'Do Thi', 'Xuan', '1986-03-09', 'Nu', 'Ha Noi', 'K12', NULL, NULL, NULL);

INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP, GHICHU, DIEMTB, XEPLOAI)
VALUES ('K1212', 'Le Thi Phi', 'Yen', '1986-03-12', 'Nu', 'TpHCM', 'K12', NULL, NULL, NULL);

INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP, GHICHU, DIEMTB, XEPLOAI)
VALUES ('K1301', 'Nguyen Thi Kim', 'Cuc', '1986-06-09', 'Nu', 'Kien Giang', 'K13', NULL, NULL, NULL);

INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP, GHICHU, DIEMTB, XEPLOAI)
VALUES ('K1302', 'Truong Thi My', 'Hien', '1986-03-18', 'Nu', 'Nghe An', 'K13', NULL, NULL, NULL);

INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP, GHICHU, DIEMTB, XEPLOAI)
VALUES ('K1303', 'Le Duc', 'Hien', '1986-03-21', 'Nam', 'Tay Ninh', 'K13', NULL, NULL, NULL);

INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP, GHICHU, DIEMTB, XEPLOAI)
VALUES ('K1304', 'Le Quang', 'Hien', '1986-04-18', 'Nam', 'TpHCM', 'K13', NULL, NULL, NULL);

INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP, GHICHU, DIEMTB, XEPLOAI)
VALUES ('K1305', 'Le Thi', 'Huong', '1986-03-27', 'Nu', 'TpHCM', 'K13', NULL, NULL, NULL);

INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP, GHICHU, DIEMTB, XEPLOAI)
VALUES ('K1306', 'Nguyen Thai', 'Huu', '1986-03-30', 'Nam', 'Ha Noi', 'K13', NULL, NULL, NULL);

INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP, GHICHU, DIEMTB, XEPLOAI)
VALUES ('K1307', 'Tran Minh', 'Man', '1986-05-28', 'Nam', 'TpHCM', 'K13', NULL, NULL, NULL);

INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP, GHICHU, DIEMTB, XEPLOAI)
VALUES ('K1308', 'Nguyen Hieu', 'Nghia', '1986-04-08', 'Nam', 'Kien Giang', 'K13', NULL, NULL, NULL);

INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP, GHICHU, DIEMTB, XEPLOAI)
VALUES ('K1309', 'Nguyen Trung', 'Nghia', '1987-01-18', 'Nam', 'Nghe An', 'K13', NULL, NULL, NULL);

INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP, GHICHU, DIEMTB, XEPLOAI)
VALUES ('K1310', 'Tran Thi Hong', 'Tham', '1986-04-22', 'Nu', 'Tay Ninh', 'K13', NULL, NULL, NULL);

INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP, GHICHU, DIEMTB, XEPLOAI)
VALUES ('K1311', 'Tran Minh', 'Thuc', '1986-04-04', 'Nam', 'TpHCM', 'K13', NULL, NULL, NULL);

INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP, GHICHU, DIEMTB, XEPLOAI)
VALUES ('K1312', 'Nguyen Thi Kim', 'Yen', '1986-09-07', 'Nu', 'TpHCM', 'K13', NULL, NULL, NULL);
SELECT * FROM HOCVIEN
-------------------------------Nhập dữ liệu cho KETQUATHI ------------------------------------------------
INSERT INTO KETQUATHI VALUES ( 'K1101','CSDL','1','2006-7-20','10','Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1101','CTDLGT','1','2006-12-28','9','Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1101','THDC','1','2006-5-20','9','Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1101','CTRR','1','2005-5-13','9.5','Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1102','CSDL','1','2006-7-20','4','Khong Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1102','CSDL','2','2006-7-27','4.25','Khong Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1102','CSDL','3','2006-8-10','4.5','Khong Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1102','CTDLGT','1','2006-12-28','4.5','Khong Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1102','CTDLGT','2','2007-1-5','4','Khong Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1102','CTDLGT','3','2007-1-15','6','Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1102','THDC','1','2006-5-20','5','Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1102','CTRR','1','2006-5-13','7','Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1103','CSDL','1','2006-7-20','3.5','Khong Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1103','CSDL','2','2006-7-27','8.25','Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1103','CTDLGT','1','2006-12-28','7','Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1103','THDC','1','2006-5-20','8','Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1103','CTRR','1','2006-5-13','6.5','Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1104','CSDL','1','2006-7-20','3.75','Khong Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1104','CTDLGT','1','2006-12-28','4','Khong Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1104','THDC','1','2006-5-20','4','Khong Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1104','CTRR','1','2006-5-13','4','Khong Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1104','CTRR','2','2006-5-20','3.5','Khong Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1104','CTRR','3','2006-6-30','4','Khong Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1201','CSDL','1','2006-7-20','6','Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1201','CTDLGT','1','2006-12-28','5','Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1201','THDC','1','2006-5-20','8.5','Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1201','CTRR','1','2006-5-13','9','Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1202','CSDL','1','2006-7-20','8','Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1202','CTDLGT','1','2006-12-28','4','Khong Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1202','CTDLGT','2','2007-1-5','5','Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1202','THDC','1','2006-5-20','4','Khong Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1202','THDC','2','2006-5-27','4','Khong Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1202','CTRR','1','2006-5-13','3','Khong Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1202','CTRR','2','2006-5-20','4','Khong Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1202','CTRR','3','2006-6-30','6.25','Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1203','CSDL','1','2006-7-20','9.25','Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1203','CTDLGT','1','2006-12-28','9.5','Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1203','THDC','1','2006-5-20','10','Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1203','CTRR','1','2006-5-13','10','Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1204','CSDL','1','2006-7-20','8.5','Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1204','CTDLGT','1','2006-12-28','6.75','Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1204','THDC','1','2006-5-20','4','Khong Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1204','CTRR','1','2006-5-13','6','Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1301','CSDL','1','2006-12-20','4.25','Khong Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1301','CTDLGT','1','2006-7-25','8','Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1301','THDC','1','2006-5-20','7.75','Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1301','CTRR','1','2006-5-13','8','Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1302','CSDL','1','2006-12-20','6.75','Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1302','CTDLGT','1','2006-7-25','5','Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1302','THDC','1','2006-5-20','8','Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1302','CTRR','1','2006-5-13','8.5','Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1303','CSDL','1','2006-12-20','4','Khong Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1303','CTDLGT','1','2006-7-25','4.5','Khong Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1303','CTDLGT','2','2006-8-7','4','Khong Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1303','CTDLGT','3','2006-8-15','4.25','Khong Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1303','THDC','1','2006-5-20','4.5','Khong Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1303','CTRR','1','2006-5-13','3.25','Khong Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1303','CTRR','2','2006-5-20','5','Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1304','CSDL','1','2006-12-20','7.75','Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1304','CTDLGT','1','2006-7-25','9.75','Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1304','THDC','1','2006-5-20','5.5','Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1304','CTRR','1','2006-5-13','5','Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1305','CSDL','1','2006-12-20','9.25','Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1305','CTDLGT','1','2006-7-25','10','Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1305','THDC','1','2006-5-20','8','Dat')  
 INSERT INTO KETQUATHI VALUES ( 'K1305','CTRR','1','2006-5-13','10','Dat')  
 SELECT * FROM KETQUATHI


 
--II. Ngôn ngữ thao tác dữ liệu (Data Manipulation Language):

--1. Tăng hệ số lương thêm 0.2 cho những giáo viên là trưởng khoa.

UPDATE GIAOVIEN SET HESO= HESO + 0.2 
WHERE MAGV IN (SELECT TRGKHOA FROM KHOA)
SELECT * FROM GIAOVIEN
--2. Cập nhật giá trị điểm trung bình tất cả các môn học (DIEMTB) của mỗi học viên (tất cả các
--môn học đều có hệ số 1 và nếu học viên thi một môn nhiều lần, chỉ lấy điểm của lần thi sau
--cùng).
UPDATE HV SET DIEMTB = DTB_HOCVIEN.DTB
select*
FROM HOCVIEN HV LEFT JOIN (
SELECT A.MAHV, AVG(A.DIEM) AS DTB 
	FROM KETQUATHI A 
	INNER JOIN 
	(
		SELECT MAHV, MAMH, MAX(LANTHI) LANTHIMAX
		FROM KETQUATHI
		GROUP BY MAHV, MAMH
	) B 
	ON A.MAHV = B.MAHV AND A.MAMH = B.MAMH AND A.LANTHI = B.LANTHIMAX 
	GROUP BY A.MAHV
) DTB_HOCVIEN
ON HV.MAHV = DTB_HOCVIEN.MAHV
GO
SELECT * FROM HOCVIEN

--3. Cập nhật giá trị cho cột GHICHU là “Cam thi” đối với trường hợp: học viên có một môn bất kỳ thi lần thứ 3 dưới 5 điểm.
UPDATE HOCVIEN SET GHICHU='Cam thi' 
WHERE MAHV IN( SELECT MAHV FROM KETQUATHI WHERE LANTHI = 3 AND DIEM <5)
SELECT * FROM HOCVIEN
--4. Cập nhật giá trị cho cột XEPLOAI trong quan hệ HOCVIEN như sau:

--o Nếu DIEMTB  9 thì XEPLOAI =”XS”
--o Nếu 8  DIEMTB < 9 thì XEPLOAI = “G”
--o Nếu 6.5  DIEMTB < 8 thì XEPLOAI = “K”
--o Nếu 5  DIEMTB < 6.5 thì XEPLOAI = “TB”
--o Nếu DIEMTB < 5 thì XEPLOAI = ”Y”
UPDATE HOCVIEN SET XEPLOAI = CASE 
	WHEN DIEMTB >= 9 THEN 'XS'
	WHEN DIEMTB >= 8 AND DIEMTB <9 THEN 'G'
	WHEN DIEMTB >= 6.5 AND DIEMTB <8 THEN 'K'
	WHEN DIEMTB >= 5 AND DIEMTB <6.5 THEN 'TB'
	ELSE 'Y'
END;
GO
SELECT * FROM HOCVIEN


 --III. Ngôn ngữ truy vấn dữ liệu:

 --1. In ra danh sách (mã học viên, họ tên, ngày sinh, mã lớp) lớp trưởng của các lớp.
 SELECT  HV.MAHV, HO+ ' '+TEN AS HOTEN, NGSINH, HV.MALOP 
 FROM HOCVIEN HV INNER JOIN LOP 
 ON HV.MAHV = LOP.TRGLOP
 GO
 
 --2. In ra bảng điểm khi thi (mã học viên, họ tên , lần thi, điểm số) môn CTRR của lớp “K12”, sắp xếp theo tên, họ học viên.
 SELECT KQ.MAHV, HO+ ' '+TEN AS HOTEN, LANTHI, DIEM 
 FROM KETQUATHI KQ INNER JOIN HOCVIEN HV
 ON KQ.MAHV =HV.MAHV 
 WHERE KQ.MAMH='CTRR' AND HV.MALOP='K12' 
 ORDER BY TEN, HO
 GO

 --3. In ra danh sách những học viên (mã học viên, họ tên) và những môn học mà học viên đó thi lần thứ nhất đã đạt.
 SELECT KQ.MAHV, HO+ ' '+TEN AS HOTEN,MAMH
 FROM KETQUATHI KQ INNER JOIN HOCVIEN HV
 ON KQ.MAHV =HV.MAHV 
 WHERE LANTHI=1 AND KQ.KQUA = 'Dat'
 GO

 --4. In ra danh sách học viên (mã học viên, họ tên) của lớp “K11” thi môn CTRR không đạt (ở lần thi 1).
 SELECT KQ.MAHV, HO+ ' '+TEN AS HOTEN
 FROM KETQUATHI KQ INNER JOIN HOCVIEN HV
 ON KQ.MAHV =HV.MAHV 
 WHERE HV.MALOP='K11' AND KQ.MAMH ='CTRR' AND LANTHI=1 AND KQ.KQUA = 'Khong Dat'
 GO

 --5. * Danh sách học viên (mã học viên, họ tên) của lớp “K” thi môn CTRR không đạt (ở tất cả các lần thi).
 --Cách 1:
 SELECT A.MAHV, HOTEN FROM (
	SELECT KQ.MAHV, HO + ' ' + TEN AS HOTEN, LANTHI,MAMH ,KQUA
	FROM KETQUATHI KQ INNER JOIN HOCVIEN HV 
	ON KQ.MAHV = HV.MAHV
	WHERE LEFT(HV.MALOP, 1) = 'K' AND MAMH = 'CTRR' AND KQUA = 'Khong Dat'
) A 
INNER JOIN (
	SELECT MAHV,MAMH, MAX(LANTHI) AS LANTHIMAX  FROM KETQUATHI 
	WHERE LEFT(MAHV, 3) LIKE 'K[0-9][0-9]' AND MAMH = 'CTRR'
	GROUP BY MAHV, MAMH 
) B 
ON A.MAHV = B.MAHV
WHERE LANTHI = LANTHIMAX
GO
-- Cách 2:
SELECT DISTINCT HV.MAHV, HV.HO + ' ' + HV.TEN AS HOTEN
FROM HOCVIEN HV JOIN KETQUATHI KQ 
ON HV.MAHV =KQ.MAHV
WHERE (HV.MALOP LIKE 'K%') AND (KQ.MAMH ='CTRR') 

EXCEPT
 
SELECT DISTINCT HV.MAHV, HV.HO + ' ' + HV.TEN AS HOTEN
FROM HOCVIEN HV JOIN KETQUATHI KQ 
ON HV.MAHV =KQ.MAHV
WHERE (HV.MALOP LIKE 'K%') AND (KQ.MAMH ='CTRR') AND ( KQ.KQUA= 'Dat')
-- Cách 3:
SELECT DISTINCT HV.MAHV, HV.HO + ' ' + HV.TEN AS HOTEN
FROM HOCVIEN HV JOIN KETQUATHI KQ1 
ON HV.MAHV =KQ1.MAHV
WHERE (HV.MALOP LIKE 'K%') AND (KQ1.MAMH ='CTRR') AND 
								NOT EXISTS (SELECT KQ2.MAHV FROM KETQUATHI KQ2
											WHERE (HV.MAHV = KQ2.MAHV  AND (KQ2.MAMH = 'CTRR') AND (KQ2.KQUA ='Dat') ))


--6. Tìm tên những môn học mà giáo viên có tên “Tran Tam Thanh” dạy trong học kỳ 1 năm 2006.
SELECT MAMH,TENMH FROM MONHOC
WHERE MAMH IN(
				SELECT DISTINCT MAMH 
				FROM  GIANGDAY GD INNER JOIN GIAOVIEN GV 
				ON GD.MAGV = GV.MAGV  
				WHERE GV.HOTEN ='Tran Tam Thanh' AND GD.HOCKY ='1' AND GD.NAM=2006 
				)
	GO

--7. Tìm những môn học (mã môn học, tên môn học) mà giáo viên chủ nhiệm lớp “K11” dạy trong học kỳ 1 năm 2006.
-- Cách 1:
SELECT MAMH,TENMH FROM MONHOC
WHERE MAMH IN
(
SELECT DISTINCT MAMH FROM  GIANGDAY  
	WHERE MAGV IN(
						SELECT MAGVCN FROM LOP
						WHERE MALOP = 'K11'
					) 
					AND HOCKY ='1' AND NAM=2006 
)
GO
--Cách 2:
SELECT MAMH, TENMH FROM MONHOC
WHERE MAMH IN (
				SELECT GD.MAMH 
				FROM GIANGDAY GD INNER JOIN LOP
				ON GD.MAGV= LOP.MAGVCN
				WHERE  LOP.MALOP = 'K11' AND HOCKY ='1' AND NAM=2006 )


--8. Tìm họ tên lớp trưởng của các lớp mà giáo viên có tên “Nguyen To Lan” dạy môn “Co So Du Lieu”.

SELECT  HO+ ' '+TEN AS HOTEN 
FROM HOCVIEN
WHERE MAHV IN (
				SELECT TRGLOP FROM LOP 
				WHERE MALOP IN (	SELECT MALOP FROM GIANGDAY
									WHERE   MAGV IN (
													SELECT  MAGV FROM GIAOVIEN
													WHERE HOTEN ='Nguyen To Lan')
													 AND
											MAMH IN (   SELECT MAMH FROM MONHOC
														WHERE  TENMH ='Co So Du Lieu')
								)
				)
GO

--9. In ra danh sách những môn học (mã môn học, tên môn học) phải học liền trước môn “Co So Du Lieu”.
SELECT MAMH, TENMH FROM MONHOC
WHERE MAMH IN ( SELECT MAMH_TRUOC FROM DIEUKIEN
				WHERE MAMH IN ( SELECT MAMH FROM MONHOC
								WHERE TENMH ='Co So Du Lieu'))
	
--10. Môn “Cau Truc Roi Rac” là môn bắt buộc phải học liền trước những môn học (mã môn học, tên môn học) nào.
SELECT MAMH, TENMH FROM MONHOC
WHERE MAMH IN ( SELECT MAMH FROM DIEUKIEN
				WHERE MAMH_TRUOC IN (SELECT MAMH FROM MONHOC
								WHERE TENMH ='Co So Du Lieu'))

--11. Tìm họ tên giáo viên dạy môn CTRR cho cả hai lớp “K11” và “K12” trong cùng học kỳ 1 năm 2006.
--Cách 1:

SELECT HOTEN FROM GIAOVIEN
WHERE MAGV IN (
				SELECT GV.MAGV
				FROM GIAOVIEN GV INNER JOIN GIANGDAY GD
				ON GV.MAGV = GD.MAGV
				WHERE ( GD.MALOP IN ('K11','K12') AND GD.HOCKY=1 AND  GD.NAM =2006 AND MAMH = 'CTRR' )
				GROUP BY GV.MAGV
				HAVING COUNT(DISTINCT GD.MALOP) =2)

--Cách 2:
SELECT HOTEN FROM GIAOVIEN 
WHERE MAGV IN (
	SELECT MAGV FROM GIANGDAY 
	WHERE MAMH = 'CTRR' AND MALOP IN ('K11', 'K12') AND HOCKY = 1 AND NAM = 2006
	GROUP BY MAGV 
	HAVING COUNT(DISTINCT MALOP) = 2
)
GO
--12. Tìm những học viên (mã học viên, họ tên) thi không đạt môn CSDL ở lần thi thứ 1 nhưng chưa thi lại môn này.
--Cách 1:
SELECT MAHV, HO + ' ' + TEN AS HOTEN FROM HOCVIEN
WHERE MAHV IN (
				SELECT MAHV FROM KETQUATHI
				WHERE(  KQUA ='Khong Dat'AND MAMH = 'CSDL' AND LANTHI =1) 
				EXCEPT 
				SELECT MAHV FROM KETQUATHI
				WHERE( MAMH = 'CSDL' AND LANTHI =2)
				)
--Cách 2:
SELECT MAHV, HO + ' ' + TEN AS HOTEN FROM HOCVIEN 
WHERE MAHV IN (
	SELECT MAHV FROM KETQUATHI A
	WHERE NOT EXISTS (
		SELECT 1 FROM KETQUATHI B 
		WHERE A.MAHV = B.MAHV AND A.MAMH = B.MAMH AND A.LANTHI < B.LANTHI
	) AND MAMH = 'CSDL' AND LANTHI = 1 AND KQUA = 'Khong Dat'
)
GO
--13. Tìm giáo viên (mã giáo viên, họ tên) không được phân công giảng dạy bất kỳ môn học nào.
--Cách 1:
SELECT MAGV, HOTEN FROM GIAOVIEN 
WHERE MAGV IN (
				SELECT MAGV FROM GIAOVIEN
				EXCEPT 
				SELECT DISTINCT MAGV FROM GIANGDAY
				)
--Cách 2:
SELECT MAGV, HOTEN FROM GIAOVIEN 
WHERE MAGV NOT IN (
	SELECT DISTINCT MAGV FROM GIANGDAY
)
GO
--14. Tìm giáo viên (mã giáo viên, họ tên) không được phân công giảng dạy bất kỳ môn học nào thuộc khoa giáo viên đó phụ trách.

SELECT MAGV, HOTEN FROM GIAOVIEN 
WHERE MAGV NOT IN (
					SELECT  GV.MAGV FROM  GIAOVIEN GV JOIN GIANGDAY GD 
					ON GV.MAGV= GD.MAGV 
					JOIN MONHOC MH 
					ON MH.MAMH = GD.MAMH
					WHERE GV.MAKHOA =MH.MAKHOA)

--15. Tìm họ tên các học viên thuộc lớp “K11” thi một môn bất kỳ quá 3 lần vẫn “Khong dat” hoặc thi lần thứ 2 môn CTRR được 5 điểm.
--Cách 1:
SELECT HO + ' ' + TEN AS HOTEN FROM HOCVIEN 
WHERE MAHV IN (
				SELECT MAHV FROM KETQUATHI
				WHERE LEFT(MAHV, 3) = 'K11' AND  LANTHI = 3 AND KQUA = 'Khong Dat'
				UNION 
				SELECT MAHV FROM KETQUATHI
				WHERE LEFT(MAHV, 3) = 'K11' AND MAMH = 'CTRR' AND LANTHI = 2 AND DIEM = 5
						)
--Cách 2:
SELECT MAHV, HO + ' ' + TEN AS HOTEN FROM HOCVIEN 
WHERE MAHV IN (
				SELECT MAHV FROM KETQUATHI
				WHERE (LEFT(MAHV, 3) = 'K11' )AND ( (LANTHI = 3 AND KQUA = 'Khong Dat')
						OR (MAMH = 'CTRR' AND LANTHI = 2 AND DIEM = 5)))

--16. Tìm họ tên giáo viên dạy môn CTRR cho ít nhất hai lớp trong cùng một học kỳ của một năm học.
SELECT HOTEN FROM GIAOVIEN 
WHERE MAGV IN (
				SELECT MAGV FROM GIANGDAY 
				WHERE MAMH = 'CTRR'
				GROUP BY MAGV, HOCKY, NAM 
				HAVING COUNT(DISTINCT MALOP) >= 2 )

--17. Danh sách học viên và điểm thi môn CSDL (chỉ lấy điểm của lần thi sau cùng).
SELECT HV.MAHV, HO + ' ' + TEN AS HOTEN, DIEM 
FROM HOCVIEN HV INNER JOIN (
							SELECT * 
							FROM KETQUATHI A
							WHERE NOT EXISTS (  SELECT * 
												FROM KETQUATHI B 
												WHERE A.MAHV = B.MAHV AND A.MAMH = B.MAMH AND A.LANTHI < B.LANTHI
											) AND MAMH = 'CSDL') DIEM_CSDL
ON DIEM_CSDL.MAHV =HV.MAHV
GO
--18. Danh sách học viên và điểm thi môn “Co So Du Lieu” (chỉ lấy điểm cao nhất của các lần thi).
--Cách 1:
SELECT HV.MAHV, HO + ' ' + TEN AS HOTEN, DIEM 
FROM HOCVIEN HV INNER JOIN (
							SELECT * 
							FROM KETQUATHI A
							WHERE NOT EXISTS (  SELECT * 
												FROM KETQUATHI B 
												WHERE A.MAHV = B.MAHV AND A.MAMH = B.MAMH AND A.DIEM < B.DIEM
											) AND MAMH = 'CSDL') DIEM_CSDL
ON DIEM_CSDL.MAHV =HV.MAHV
GO
--Cách 2:
SELECT HV.MAHV, HO + ' ' + TEN AS HOTEN, DIEM 
FROM HOCVIEN HV INNER JOIN (
	SELECT MAHV, MAX(DIEM) AS DIEM FROM KETQUATHI 
	WHERE MAMH IN (
		SELECT MAMH FROM MONHOC 
		WHERE TENMH = 'Co So Du Lieu'
	) 
	GROUP BY MAHV, MAMH
) DIEM_CSDL_MAX
ON HV.MAHV = DIEM_CSDL_MAX.MAHV
GO
--19. Khoa nào (mã khoa, tên khoa) được thành lập sớm nhất.
SELECT TOP 1 WITH TIES MAKHOA, TENKHOA FROM KHOA ORDER BY NGTLAP ASC
--20. Có bao nhiêu giáo viên có học hàm là “GS” hoặc “PGS”.
SELECT COUNT (MAGV) FROM GIAOVIEN WHERE HOCHAM IN ('GS','PGS')
--21. Thống kê có bao nhiêu giáo viên có học vị là “CN”, “KS”, “Ths”, “TS”, “PTS” trong mỗi khoa.
SELECT MAKHOA, HOCVI, COUNT( MAGV ) 
FROM GIAOVIEN
GROUP BY MAKHOA, HOCVI
ORDER BY MAKHOA
--22. Mỗi môn học thống kê số lượng học viên theo kết quả (đạt và không đạt).
--Cách 1:
SELECT A.MAMH ,A.KQUA, COUNT(MAHV) AS SOLUONGHV
FROM KETQUATHI A
WHERE NOT EXISTS ( SELECT 1 FROM KETQUATHI B
					WHERE A.MAMH=B.MAMH AND A.MAHV=B.MAHV AND A.LANTHI<B.LANTHI)
GROUP BY A.MAMH,A.KQUA
ORDER BY A.MAMH

--Cách 2:
SELECT A.MAMH, KQDAT, KQKODAT
FROM( SELECT MAMH, COUNT(KQUA) AS KQDAT FROM KETQUATHI WHERE KQUA ='Dat' GROUP BY MAMH ) A

JOIN 
(SELECT MAMH,COUNT(DISTINCT C.MAHV) AS KQKODAT FROM 
(SELECT * FROM KETQUATHI K1 WHERE KQUA ='Khong Dat' AND
	NOT EXISTS ( SELECT 1 FROM KETQUATHI K2 WHERE KQUA ='Dat' AND K2.MAHV=K1.MAHV AND K2.MAMH=K1.MAMH ) ) C
	GROUP BY C.MAMH
) B 
ON A.MAMH= B.MAMH
GO


--23. Tìm giáo viên (mã giáo viên, họ tên) là giáo viên chủ nhiệm của một lớp, đồng thời dạy cho lớp đó ít nhất một môn học.
--Cách 1:
SELECT MAGV, HOTEN
FROM GIAOVIEN
WHERE MAGV IN ( SELECT GD.MAGV 
				FROM LOP JOIN GIANGDAY GD
				ON LOP.MAGVCN= GD.MAGV)
--Cách 2:
SELECT MAGV, HOTEN
FROM GIAOVIEN GV
WHERE EXISTS ( SELECT 1 FROM(
				SELECT GD.MAGV 
				FROM LOP JOIN GIANGDAY GD
				ON LOP.MAGVCN= GD.MAGV) AS GVCN
				WHERE GV.MAGV= GVCN.MAGV)
--24. Tìm họ tên lớp trưởng của lớp có sỉ số cao nhất.
--Cách 1:
SELECT HO, TEN FROM HOCVIEN
WHERE MAHV IN ( SELECT TRGLOP FROM LOP 
				WHERE MALOP IN ( SELECT TOP 1 WITH TIES  MALOP FROM HOCVIEN
									GROUP BY MALOP 
									ORDER BY COUNT(MAHV) DESC))
--Cách 2:
SELECT HO, TEN FROM HOCVIEN
WHERE MAHV IN ( SELECT TRGLOP FROM LOP
				WHERE  EXISTS ( SELECT * FROM ( SELECT TOP 1 WITH TIES  MALOP FROM HOCVIEN
												GROUP BY MALOP 
												ORDER BY COUNT(MAHV) DESC) AS A
												WHERE LOP.MALOP= A.MALOP))
--Cách 3:
SELECT HO, TEN FROM HOCVIEN
WHERE MAHV IN ( SELECT TRGLOP FROM LOP
				WHERE MALOP IN ( SELECT MALOP FROM( SELECT MALOP ,RANK() OVER ( ORDER BY COUNT(MAHV) DESC ) AS RANK1 FROM HOCVIEN GROUP BY  MALOP ) A
												WHERE A.RANK1 = 1))
--25. * Tìm họ tên những LOPTRG thi không đạt quá 3 môn (mỗi môn đều thi không đạt ở tất cả các lần thi).
SELECT HO, TEN FROM HOCVIEN
WHERE MAHV IN ( SELECT TRGLOP FROM LOP 
				WHERE TRGLOP IN ( SELECT MAHV FROM KETQUATHI A
								  WHERE  KQUA ='Khong Dat' AND NOT EXISTS ( SELECT * FROM KETQUATHI B
														WHERE A.MAMH=B.MAMH AND A.MAHV=B.MAHV AND A.LANTHI<B.LANTHI)
									GROUP BY MAHV
									HAVING COUNT(MAMH)>=3) )

--26. Tìm học viên (mã học viên, họ tên) có số môn đạt điểm 9,10 nhiều nhất.
SELECT HO, TEN FROM HOCVIEN
WHERE MAHV IN (SELECT TOP 1 WITH TIES MAHV FROM KETQUATHI
				WHERE DIEM BETWEEN 9 AND 10
				GROUP BY MAHV
				ORDER BY COUNT( DISTINCT MAMH ) DESC)
--27. Trong từng lớp, tìm học viên (mã học viên, họ tên) có số môn đạt điểm 9,10 nhiều nhất.
--Cách 1:
SELECT MALOP, MAHV , HO, TEN FROM HOCVIEN HV
WHERE MAHV IN (SELECT TOP 1 WITH TIES KQT.MAHV FROM KETQUATHI KQT JOIN HOCVIEN HV1
				ON KQT.MAHV=HV1.MAHV
				WHERE DIEM BETWEEN 9 AND 10
				AND HV1.MALOP=HV.MALOP
				GROUP BY KQT.MAHV
				ORDER BY COUNT( DISTINCT MAMH ) DESC)
--Cách 2:
SELECT MALOP, MAHV , HO, TEN FROM 
(SELECT HV1.MALOP, KQT.MAHV , HO, TEN , RANK() OVER (PARTITION BY MALOP ORDER BY COUNT( DISTINCT MAMH ) DESC) AS RANK1
FROM KETQUATHI KQT JOIN HOCVIEN HV1
ON KQT.MAHV=HV1.MAHV
WHERE DIEM BETWEEN 9 AND 10
GROUP BY HV1.MALOP, KQT.MAHV , HO, TEN ) A
WHERE A.RANK1 =1

--28. Trong từng học kỳ của từng năm, mỗi giáo viên phân công dạy bao nhiêu môn học, bao nhiêu lớp.
SELECT HOCKY, NAM,GD.MAGV, GV.HOTEN, COUNT(DISTINCT MAMH) AS SOMON, COUNT(DISTINCT MALOP) AS SOLOP  
FROM GIANGDAY GD JOIN GIAOVIEN GV
ON GV.MAGV=GD.MAGV
GROUP BY HOCKY, NAM,GD.MAGV,GV.HOTEN
--29. Trong từng học kỳ của từng năm, tìm giáo viên (mã giáo viên, họ tên) giảng dạy nhiều nhất.
--Cách 1:
SELECT HOCKY, NAM,MAGV, HOTEN FROM
(SELECT HOCKY, NAM,GD.MAGV, GV.HOTEN,RANK() OVER(PARTITION BY HOCKY, NAM ORDER BY COUNT( MALOP) DESC ) AS RANK1
FROM GIANGDAY GD JOIN GIAOVIEN GV
ON GV.MAGV=GD.MAGV
GROUP BY HOCKY, NAM,GD.MAGV,GV.HOTEN) A
WHERE A.RANK1 =1
ORDER BY  NAM,HOCKY ASC
--Cách 2:
SELECT DISTINCT HOCKY, NAM,GD.MAGV, GV.HOTEN 
FROM GIANGDAY GD JOIN GIAOVIEN GV
ON GV.MAGV=GD.MAGV
WHERE GV.MAGV IN ( SELECT TOP 1 WITH TIES MAGV FROM GIANGDAY GD1
					WHERE GD1.HOCKY=GD.HOCKY AND GD1.NAM=GD.NAM
					GROUP BY MAGV 
					ORDER BY COUNT( MALOP) DESC )
ORDER BY  NAM,HOCKY ASC
--30. Tìm môn học (mã môn học, tên môn học) có nhiều học viên thi không đạt (ở lần thi thứ 1) nhất.
--Cách 1:
SELECT MAMH, TENMH FROM MONHOC
WHERE MAMH IN ( SELECT TOP 1 WITH TIES MAMH 
				FROM KETQUATHI 
				WHERE LANTHI =1 AND KQUA ='Khong Dat'
				GROUP BY MAMH 
				ORDER BY COUNT(KQUA) DESC )
--Cách 2:
SELECT MAMH, TENMH 
FROM ( SELECT MH.MAMH, MH.TENMH, RANK() OVER ( ORDER BY COUNT(KQUA) DESC) AS RANK1
		FROM MONHOC MH JOIN KETQUATHI KQT
		ON MH.MAMH= KQT.MAMH
		WHERE LANTHI =1 AND KQUA ='Khong Dat'
		GROUP BY MH.MAMH, MH.TENMH) A
WHERE A.RANK1=1

--31. Tìm học viên (mã học viên, họ tên) thi môn nào cũng đạt (chỉ xét lần thi thứ 1).
--Cách 1
SELECT MAHV,HO,TEN FROM HOCVIEN HV
WHERE NOT EXISTS ( SELECT * FROM MONHOC MH JOIN KETQUATHI KQ
					ON MH.MAMH= KQ.MAMH
					WHERE NOT EXISTS ( SELECT * FROM KETQUATHI KQT
										WHERE LANTHI =1 AND KQUA ='Dat'
										AND KQT.MAHV= HV.MAHV AND KQT.MAMH = MH.MAMH))

--Cách 2:
SELECT A.MAHV, HO + ' ' + TEN HOTEN FROM (
	SELECT MAHV, COUNT(KQUA) SODAT FROM KETQUATHI 
	WHERE LANTHI = 1 AND KQUA = 'Dat'
	GROUP BY MAHV
	INTERSECT
	SELECT MAHV, COUNT(MAMH) SOMH FROM KETQUATHI 
	WHERE LANTHI = 1
	GROUP BY MAHV
) A INNER JOIN HOCVIEN HV
ON A.MAHV = HV.MAHV
--32. * Tìm học viên (mã học viên, họ tên) thi môn nào cũng đạt (chỉ xét lần thi sau cùng).
--Cách 1
SELECT MAHV,HO,TEN FROM HOCVIEN HV
WHERE NOT EXISTS ( SELECT * FROM MONHOC MH JOIN KETQUATHI KQ
					ON MH.MAMH= KQ.MAMH
					WHERE NOT EXISTS (
										SELECT 1 
										FROM KETQUATHI B 
										WHERE KQ.MAHV = B.MAHV AND KQ.MAMH = B.MAMH AND KQ.LANTHI < B.LANTHI
									  ) AND NOT EXISTS ( SELECT * FROM KETQUATHI KQT
															WHERE KQUA ='Dat'AND KQT.MAHV= HV.MAHV AND KQT.MAMH = MH.MAMH
															  AND NOT EXISTS ( SELECT 1 FROM KETQUATHI A
																				WHERE A.MAMH=KQT.MAMH AND A.MAHV=KQT.MAHV AND KQT.LANTHI<A.LANTHI)))
--Cách 2:
SELECT C.MAHV, HO + ' ' + TEN HOTEN FROM (
	SELECT MAHV, COUNT(KQUA) SODAT FROM KETQUATHI A
	WHERE NOT EXISTS (
		SELECT 1 
		FROM KETQUATHI B 
		WHERE A.MAHV = B.MAHV AND A.MAMH = B.MAMH AND A.LANTHI < B.LANTHI
	) AND KQUA = 'Dat'
	GROUP BY MAHV
	INTERSECT
	SELECT MAHV, COUNT(MAMH) SOMH FROM KETQUATHI A
	WHERE NOT EXISTS (
		SELECT 1 
		FROM KETQUATHI B 
		WHERE A.MAHV = B.MAHV AND A.MAMH = B.MAMH AND A.LANTHI < B.LANTHI
	)
	GROUP BY MAHV
) C INNER JOIN HOCVIEN HV
ON C.MAHV = HV.MAHV
GO

--33. * Tìm học viên (mã học viên, họ tên) đã thi tất cả các môn đều đạt (chỉ xét lần thi thứ 1).
SELECT MAHV,HO,TEN FROM HOCVIEN HV
WHERE NOT EXISTS ( SELECT * FROM MONHOC MH
					WHERE NOT EXISTS ( SELECT * FROM KETQUATHI KQT
										WHERE LANTHI =1 AND KQUA ='Dat'
										AND KQT.MAHV= HV.MAHV AND KQT.MAMH = MH.MAMH))
--34. * Tìm học viên (mã học viên, họ tên) đã thi tất cả các môn đều đạt (chỉ xét lần thi sau cùng).
SELECT MAHV,HO,TEN FROM HOCVIEN HV
WHERE NOT EXISTS ( SELECT * FROM MONHOC MH 
					WHERE  NOT EXISTS ( SELECT * FROM KETQUATHI KQT
															WHERE KQUA ='Dat'AND KQT.MAHV= HV.MAHV AND KQT.MAMH = MH.MAMH
															  AND NOT EXISTS ( SELECT 1 FROM KETQUATHI A
																				WHERE A.MAMH=KQT.MAMH AND A.MAHV=KQT.MAHV AND KQT.LANTHI<A.LANTHI)))
--35. ** Tìm học viên (mã học viên, họ tên) có điểm thi cao nhất trong từng môn (lấy điểm ở lần thi sau cùng).
--Cách 1
SELECT MAMH, MAHV , HO, TEN FROM
( SELECT MAMH, HV.MAHV , HO, TEN,DIEM, RANK () OVER ( PARTITION BY MAMH ORDER BY DIEM DESC ) AS RANK1
FROM HOCVIEN HV JOIN KETQUATHI KQT ON HV.MAHV= KQT.MAHV
WHERE NOT EXISTS ( SELECT 1 FROM KETQUATHI A
					WHERE A.MAMH=KQT.MAMH AND A.MAHV=KQT.MAHV AND KQT.LANTHI<A.LANTHI)) A
WHERE A.RANK1=1
ORDER BY MAMH ASC
--Cách 2:
SELECT MAMH, HV.MAHV , HO, TEN, DIEM 
FROM  HOCVIEN HV JOIN KETQUATHI KQT 
ON HV.MAHV= KQT.MAHV
WHERE KQT.MAHV IN (SELECT TOP 1 WITH TIES KQT2.MAHV
					FROM KETQUATHI KQT2
					WHERE KQT.MAMH= KQT2.MAMH
					AND NOT EXISTS ( SELECT 1 FROM KETQUATHI A
									WHERE A.MAMH=KQT2.MAMH AND A.MAHV=KQT2.MAHV AND KQT2.LANTHI<A.LANTHI)
					ORDER BY DIEM DESC)

--Cách 3:
SELECT MAMH, MAHV , HO, TEN, DIEM FROM(
 SELECT TOP 1 WITH TIES MAMH, HV.MAHV ,DIEM, HO, TEN
					FROM  HOCVIEN HV JOIN KETQUATHI KQT 
					ON HV.MAHV= KQT.MAHV
					WHERE NOT EXISTS ( SELECT 1 FROM KETQUATHI A
									WHERE A.MAMH=KQT.MAMH AND A.MAHV=KQT.MAHV AND KQT.LANTHI<A.LANTHI)
					ORDER BY DIEM DESC) A
ORDER BY MAMH ASC



